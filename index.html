<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Freedom Is Coming</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;1,300&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0a0806;
    color: #fff;
    overflow: hidden;
    font-family: 'DM Sans', sans-serif;
  }

  #gl { position: fixed; inset: 0; z-index: 0; }
  canvas { display: block; }

  /* === CINEMATIC CURTAIN REVEAL === */
  .curtain-left, .curtain-right {
    position: fixed;
    top: 0; bottom: 0;
    width: 50%;
    background: #0a0806;
    z-index: 100;
    animation: curtainOpen 2s cubic-bezier(0.76, 0, 0.24, 1) 0.3s forwards;
  }
  .curtain-left { left: 0; transform-origin: left; }
  .curtain-right { right: 0; transform-origin: right; }
  @keyframes curtainOpen {
    to { transform: scaleX(0); }
  }

  .curtain-line {
    position: fixed;
    top: 0; bottom: 0;
    left: 50%;
    width: 1px;
    background: linear-gradient(180deg, transparent, #d4a060, transparent);
    z-index: 101;
    opacity: 0;
    animation: lineFlash 2s ease 0.1s forwards;
  }
  @keyframes lineFlash {
    0% { opacity: 0; }
    15% { opacity: 1; }
    100% { opacity: 0; }
  }

  /* === NOISE OVERLAY === */
  .noise {
    position: fixed; inset: 0; z-index: 8;
    pointer-events: none;
    opacity: 0.035;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    background-size: 200px;
  }

  /* === UI LAYER === */
  .ui {
    position: fixed; inset: 0;
    z-index: 10;
    pointer-events: none;
    display: grid;
    grid-template-rows: auto 1fr auto;
    padding: clamp(16px, 3vw, 40px);
  }

  /* --- NAV --- */
  .nav {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    opacity: 0;
    animation: fadeIn 1s ease 2.5s forwards;
  }

  .nav-brand {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .nav-brand .label {
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 6px;
    text-transform: uppercase;
    color: rgba(212,160,96,0.5);
  }

  .nav-brand .sub {
    font-size: 9px;
    font-weight: 300;
    letter-spacing: 3px;
    color: rgba(255,255,255,0.15);
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .nav-link {
    font-size: 10px;
    font-weight: 400;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(255,255,255,0.2);
    text-decoration: none;
    pointer-events: all;
    transition: color 0.3s;
  }

  .nav-link:hover { color: rgba(212,160,96,0.7); }

  .beacon-indicator {
    width: 6px; height: 6px;
    background: #d4a060;
    border-radius: 50%;
    animation: beaconPulse 3s ease-in-out infinite;
    box-shadow: 0 0 8px rgba(212,160,96,0.6);
  }

  @keyframes beaconPulse {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.5); }
  }

  /* --- HERO CENTER --- */
  .hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0;
  }

  .hero-overline {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    font-weight: 300;
    font-style: italic;
    letter-spacing: 4px;
    color: rgba(212,160,96,0.4);
    margin-bottom: 24px;
    opacity: 0;
    animation: typeReveal 0.8s ease 2.8s forwards;
  }

  .hero-title {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: clamp(40px, 10vw, 140px);
    line-height: 0.88;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: -0.02em;
    color: transparent;
    position: relative;
  }

  .hero-title .word {
    display: block;
    opacity: 0;
    transform: translateY(60px) rotateX(-15deg);
    animation: wordReveal 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  .hero-title .word:nth-child(1) { animation-delay: 2.2s; }
  .hero-title .word:nth-child(2) { animation-delay: 2.5s; }
  .hero-title .word:nth-child(3) { animation-delay: 2.8s; }

  .hero-title .word span {
    background: linear-gradient(
      135deg,
      #f5e6d0 0%,
      #d4a060 30%,
      #c07830 60%,
      #8b5a2b 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  @keyframes wordReveal {
    to {
      opacity: 1;
      transform: translateY(0) rotateX(0deg);
    }
  }

  .hero-body {
    margin-top: 36px;
    max-width: 420px;
    text-align: center;
    font-size: clamp(12px, 1.4vw, 16px);
    font-weight: 300;
    line-height: 1.8;
    color: rgba(255,245,235,0.35);
    opacity: 0;
    animation: fadeIn 1.2s ease 3.4s forwards;
  }

  .hero-cta {
    margin-top: 40px;
    display: flex;
    align-items: center;
    gap: 16px;
    opacity: 0;
    animation: fadeIn 1s ease 4s forwards;
  }

  .btn {
    pointer-events: all;
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: #0a0806;
    background: linear-gradient(135deg, #d4a060, #f0c878);
    border: none;
    padding: 15px 36px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.4s ease;
    clip-path: polygon(0 0, calc(100% - 12px) 0, 100% 12px, 100% 100%, 12px 100%, 0 calc(100% - 12px));
  }

  .btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #f0c878, #fff0d0);
    opacity: 0;
    transition: opacity 0.4s;
  }

  .btn:hover::after { opacity: 1; }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(212,160,96,0.25); }

  .btn-text { position: relative; z-index: 1; }

  .btn-ghost {
    pointer-events: all;
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(212,160,96,0.5);
    background: none;
    border: 1px solid rgba(212,160,96,0.15);
    padding: 14px 28px;
    cursor: pointer;
    transition: all 0.4s ease;
  }

  .btn-ghost:hover {
    color: rgba(212,160,96,0.9);
    border-color: rgba(212,160,96,0.4);
    background: rgba(212,160,96,0.05);
  }

  /* --- FOOTER --- */
  .footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    opacity: 0;
    animation: fadeIn 1s ease 3s forwards;
  }

  .footer-left {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .ticker {
    font-family: 'DM Sans', monospace;
    font-size: 9px;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.1);
    overflow: hidden;
    height: 14px;
  }

  .ticker-inner {
    animation: tickerScroll 8s linear infinite;
  }

  @keyframes tickerScroll {
    0% { transform: translateY(0); }
    25% { transform: translateY(-14px); }
    50% { transform: translateY(-28px); }
    75% { transform: translateY(-42px); }
    100% { transform: translateY(-56px); }
  }

  .ticker-inner div { height: 14px; line-height: 14px; white-space: nowrap; }

  .scroll-hint {
    font-size: 9px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: rgba(212,160,96,0.2);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .scroll-line {
    width: 30px;
    height: 1px;
    background: rgba(212,160,96,0.15);
    position: relative;
    overflow: hidden;
  }

  .scroll-line::after {
    content: '';
    position: absolute;
    top: 0; left: -100%; bottom: 0;
    width: 100%;
    background: rgba(212,160,96,0.5);
    animation: scrollSlide 2s ease-in-out infinite;
  }

  @keyframes scrollSlide {
    0% { left: -100%; }
    50% { left: 100%; }
    100% { left: 100%; }
  }

  .footer-right {
    text-align: right;
  }

  .footer-right .year {
    font-family: 'Syne', sans-serif;
    font-size: 48px;
    font-weight: 800;
    line-height: 1;
    color: rgba(212,160,96,0.06);
  }

  .footer-right .sig {
    font-size: 9px;
    font-weight: 300;
    font-style: italic;
    letter-spacing: 2px;
    color: rgba(255,255,255,0.1);
    margin-top: 4px;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes typeReveal {
    from { opacity: 0; letter-spacing: 12px; }
    to { opacity: 1; letter-spacing: 4px; }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .nav-link { display: none; }
    .footer-right .year { font-size: 32px; }
    .hero-cta { flex-direction: column; }
  }
</style>
</head>
<body>

<!-- Curtain Reveal -->
<div class="curtain-left"></div>
<div class="curtain-right"></div>
<div class="curtain-line"></div>

<!-- Three.js Canvas -->
<div id="gl"></div>

<!-- Noise texture -->
<div class="noise"></div>

<!-- UI Layer -->
<div class="ui">

  <nav class="nav">
    <div class="nav-brand">
      <div class="label">Freedom.gov</div>
      <div class="sub">Department of State</div>
    </div>
    <div class="nav-right">
      <a class="nav-link" href="#">About</a>
      <a class="nav-link" href="#">Access</a>
      <a class="nav-link" href="#">Protocol</a>
      <div class="beacon-indicator"></div>
    </div>
  </nav>

  <div class="hero">
    <div class="hero-overline">— Reclaim what is yours —</div>
    <h1 class="hero-title">
      <div class="word"><span>Freedom</span></div>
      <div class="word"><span>Is</span></div>
      <div class="word"><span>Coming</span></div>
    </h1>
    <p class="hero-body">
      Information is power. Reclaim your human right
      to free expression.
    </p>
    <div class="hero-cta">
      <button class="btn" id="pulseBtn"><span class="btn-text">Get Ready</span></button>
      <button class="btn-ghost">Learn More</button>
    </div>
  </div>

  <div class="footer">
    <div class="footer-left">
      <div class="ticker">
        <div class="ticker-inner">
          <div>SIGNAL STRENGTH ████████░░ 82%</div>
          <div>NODES ACTIVE: 1,247,903</div>
          <div>ENCRYPTION: AES-256-GCM</div>
          <div>UPLINK STATUS: NOMINAL</div>
          <div>SIGNAL STRENGTH ████████░░ 82%</div>
        </div>
      </div>
      <div class="scroll-hint">
        <div class="scroll-line"></div>
        Interact
      </div>
    </div>
    <div class="footer-right">
      <div class="year">2026</div>
      <div class="sig">United States of America</div>
    </div>
  </div>

</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

// ── Renderer ──
const container = document.getElementById('gl');
const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false, powerPreference: 'high-performance' });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.0;
container.appendChild(renderer.domElement);

// ── Scene ──
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0a0806);

const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000);
camera.position.set(0, 40, 160);

// ── Post Processing ──
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));
const bloom = new UnrealBloomPass(
  new THREE.Vector2(window.innerWidth, window.innerHeight),
  0.45, 0.6, 0.9
);
composer.addPass(bloom);

// ── Mouse ──
const pointer = { x: 0, y: 0, sx: 0, sy: 0 };
let pulseTime = -10;

document.addEventListener('mousemove', e => {
  pointer.x = (e.clientX / window.innerWidth - 0.5) * 2;
  pointer.y = (e.clientY / window.innerHeight - 0.5) * 2;
});

document.getElementById('pulseBtn').addEventListener('click', () => {
  pulseTime = performance.now() / 1000;
});

// ═══════════════════════════════════
// 1. GROUND PLANE — reflective grid
// ═══════════════════════════════════
const groundGeo = new THREE.PlaneGeometry(800, 800, 120, 120);
const groundMat = new THREE.ShaderMaterial({
  uniforms: {
    uTime: { value: 0 },
    uPulse: { value: -10 },
    uColor: { value: new THREE.Color(0xd4a060) }
  },
  vertexShader: `
    uniform float uTime;
    uniform float uPulse;
    varying vec2 vUv;
    varying float vDist;
    void main() {
      vUv = uv;
      vec3 pos = position;
      float d = length(pos.xy);
      vDist = d;
      // Ripple from center
      float ripple = sin(d * 0.05 - uTime * 2.0) * 2.0 * exp(-d * 0.005);
      // Pulse wave
      float timeSincePulse = uTime - uPulse;
      float pulseWave = 0.0;
      if (timeSincePulse > 0.0 && timeSincePulse < 4.0) {
        float waveFront = timeSincePulse * 80.0;
        pulseWave = sin((d - waveFront) * 0.15) * 8.0
                    * exp(-abs(d - waveFront) * 0.02)
                    * exp(-timeSincePulse * 0.8);
      }
      pos.z += ripple + pulseWave;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }
  `,
  fragmentShader: `
    uniform float uTime;
    uniform vec3 uColor;
    varying vec2 vUv;
    varying float vDist;
    void main() {
      vec2 grid = abs(fract(vUv * 60.0) - 0.5);
      float line = min(grid.x, grid.y);
      float gridAlpha = 1.0 - smoothstep(0.0, 0.04, line);
      float fade = exp(-vDist * 0.006);
      float centerGlow = exp(-vDist * 0.015) * 0.3;
      vec3 col = uColor * (gridAlpha * 0.12 * fade + centerGlow);
      gl_FragColor = vec4(col, 1.0);
    }
  `,
  transparent: true,
  side: THREE.DoubleSide
});
const ground = new THREE.Mesh(groundGeo, groundMat);
ground.rotation.x = -Math.PI / 2;
ground.position.y = -30;
scene.add(ground);

// ═══════════════════════════════════
// 2. MONUMENT GROUP
// ═══════════════════════════════════
const monumentGroup = new THREE.Group();
scene.add(monumentGroup);

// Subtle point light to illuminate fragments
const innerLight = new THREE.PointLight(0xd4a060, 8, 150);
innerLight.position.y = 20;
monumentGroup.add(innerLight);

// ═══════════════════════════════════
// 4. ORBITING FRAGMENTS
// ═══════════════════════════════════
const fragmentCount = 60;
const fragments = [];
const fragGeo = new THREE.BoxGeometry(1, 1, 1);
const fragMat = new THREE.MeshStandardMaterial({
  color: 0xd4a060,
  emissive: 0xd4a060,
  emissiveIntensity: 0.4,
  metalness: 0.9,
  roughness: 0.2,
  transparent: true,
  opacity: 0.7
});

for (let i = 0; i < fragmentCount; i++) {
  const mesh = new THREE.Mesh(fragGeo, fragMat.clone());
  const angle = (i / fragmentCount) * Math.PI * 2;
  const radius = 25 + Math.random() * 40;
  const height = (Math.random() - 0.3) * 80;
  const speed = 0.15 + Math.random() * 0.3;
  const scale = 0.3 + Math.random() * 1.8;
  mesh.scale.set(scale, scale * (0.5 + Math.random()), scale);
  mesh.userData = { angle, radius, height, speed, baseScale: scale, phase: Math.random() * Math.PI * 2 };
  monumentGroup.add(mesh);
  fragments.push(mesh);
}

// ═══════════════════════════════════
// 5. PARTICLE EMBER FIELD
// ═══════════════════════════════════
const emberCount = 4000;
const emberPositions = new Float32Array(emberCount * 3);
const emberVelocities = new Float32Array(emberCount * 3);
const emberLifetimes = new Float32Array(emberCount);
const emberSizes = new Float32Array(emberCount);

function initEmber(i) {
  const angle = Math.random() * Math.PI * 2;
  const radius = 5 + Math.random() * 120;
  emberPositions[i * 3] = Math.cos(angle) * radius;
  emberPositions[i * 3 + 1] = -30 + Math.random() * 10;
  emberPositions[i * 3 + 2] = Math.sin(angle) * radius;
  emberVelocities[i * 3] = (Math.random() - 0.5) * 0.3;
  emberVelocities[i * 3 + 1] = 0.3 + Math.random() * 1.2;
  emberVelocities[i * 3 + 2] = (Math.random() - 0.5) * 0.3;
  emberLifetimes[i] = Math.random();
  emberSizes[i] = 1.0 + Math.random() * 3.0;
}

for (let i = 0; i < emberCount; i++) initEmber(i);

const emberGeo = new THREE.BufferGeometry();
emberGeo.setAttribute('position', new THREE.BufferAttribute(emberPositions, 3));
emberGeo.setAttribute('aLife', new THREE.BufferAttribute(emberLifetimes, 1));
emberGeo.setAttribute('aSize', new THREE.BufferAttribute(emberSizes, 1));

const emberMat = new THREE.ShaderMaterial({
  uniforms: {
    uTime: { value: 0 },
    uColor: { value: new THREE.Color(0xd4a060) }
  },
  vertexShader: `
    attribute float aLife;
    attribute float aSize;
    uniform float uTime;
    varying float vAlpha;
    varying float vLife;
    void main() {
      vLife = aLife;
      vec4 mvp = modelViewMatrix * vec4(position, 1.0);
      float fadeCurve = sin(aLife * 3.14159);
      vAlpha = fadeCurve;
      gl_PointSize = aSize * fadeCurve * (200.0 / -mvp.z);
      gl_Position = projectionMatrix * mvp;
    }
  `,
  fragmentShader: `
    uniform vec3 uColor;
    varying float vAlpha;
    varying float vLife;
    void main() {
      float d = length(gl_PointCoord - 0.5) * 2.0;
      float circle = 1.0 - smoothstep(0.0, 1.0, d);
      // Color shifts from warm orange to pale as it rises
      vec3 col = mix(uColor * 1.5, vec3(1.0, 0.95, 0.85), vLife);
      gl_FragColor = vec4(col, circle * vAlpha * 0.5);
    }
  `,
  transparent: true,
  depthWrite: false,
  blending: THREE.AdditiveBlending
});

const embers = new THREE.Points(emberGeo, emberMat);
scene.add(embers);

// ═══════════════════════════════════
// 6. CONCENTRIC PULSE RINGS
// ═══════════════════════════════════
const ringGroup = new THREE.Group();
ringGroup.position.y = -29.5;
ringGroup.rotation.x = -Math.PI / 2;
scene.add(ringGroup);

const pulseRings = [];
for (let i = 0; i < 5; i++) {
  const ringGeo = new THREE.RingGeometry(20 + i * 30, 21 + i * 30, 128);
  const ringMat = new THREE.MeshBasicMaterial({
    color: 0xd4a060,
    transparent: true,
    opacity: 0.03,
    side: THREE.DoubleSide,
    blending: THREE.AdditiveBlending
  });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ringGroup.add(ring);
  pulseRings.push({ mesh: ring, baseRadius: 20 + i * 30 });
}

// ═══════════════════════════════════
// 7. FLOATING GLYPHS — text fragments
// ═══════════════════════════════════
const glyphCanvas = document.createElement('canvas');
glyphCanvas.width = 256;
glyphCanvas.height = 64;
const glyphCtx = glyphCanvas.getContext('2d');

const phrases = ['LIBERTY', 'VOICE', 'TRUTH', 'SIGNAL', 'OPEN', 'ACCESS', 'SPEAK', 'FREE'];
const glyphGroup = new THREE.Group();
scene.add(glyphGroup);

phrases.forEach((text, i) => {
  glyphCtx.clearRect(0, 0, 256, 64);
  glyphCtx.fillStyle = '#d4a060';
  glyphCtx.font = '700 28px Syne, sans-serif';
  glyphCtx.textAlign = 'center';
  glyphCtx.fillText(text, 128, 40);
  const tex = new THREE.CanvasTexture(glyphCanvas);
  tex.needsUpdate = true;
  const spriteMat = new THREE.SpriteMaterial({
    map: tex.clone(),
    transparent: true,
    opacity: 0.06,
    blending: THREE.AdditiveBlending,
    depthWrite: false
  });
  const sprite = new THREE.Sprite(spriteMat);
  const angle = (i / phrases.length) * Math.PI * 2;
  const r = 80 + Math.random() * 60;
  sprite.position.set(Math.cos(angle) * r, -10 + Math.random() * 80, Math.sin(angle) * r);
  sprite.scale.set(25, 6, 1);
  sprite.userData = { angle, r, speed: 0.02 + Math.random() * 0.03, baseY: sprite.position.y };
  glyphGroup.add(sprite);
});

// ═══════════════════════════════════
// 8. AMBIENT LIGHTING
// ═══════════════════════════════════
scene.add(new THREE.AmbientLight(0x1a1008, 0.5));
const topLight = new THREE.DirectionalLight(0xf5e6d0, 0.3);
topLight.position.set(0, 100, 50);
scene.add(topLight);

// ═══════════════════════════════════
// ANIMATION LOOP
// ═══════════════════════════════════
const clock = new THREE.Clock();

function animate() {
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();
  const dt = clock.getDelta() || 0.016;

  // Smooth mouse
  pointer.sx += (pointer.x - pointer.sx) * 0.04;
  pointer.sy += (pointer.y - pointer.sy) * 0.04;

  // Camera orbit
  const camAngle = pointer.sx * 0.4;
  const camHeight = 40 - pointer.sy * 20;
  camera.position.x = Math.sin(camAngle) * 160;
  camera.position.z = Math.cos(camAngle) * 160;
  camera.position.y = camHeight;
  camera.lookAt(0, 15, 0);

  // Uniforms
  groundMat.uniforms.uTime.value = t;
  groundMat.uniforms.uPulse.value = pulseTime;
  emberMat.uniforms.uTime.value = t;

  // Inner light subtle flicker
  innerLight.intensity = 6 + Math.sin(t * 2) * 2;

  // Fragments orbit
  fragments.forEach(f => {
    const d = f.userData;
    d.angle += d.speed * 0.01;
    f.position.x = Math.cos(d.angle) * d.radius;
    f.position.z = Math.sin(d.angle) * d.radius;
    f.position.y = d.height + Math.sin(t * d.speed * 2 + d.phase) * 5;
    f.rotation.x = t * d.speed;
    f.rotation.z = t * d.speed * 0.7;
    const breathe = 1 + Math.sin(t * 2 + d.phase) * 0.15;
    f.scale.setScalar(d.baseScale * breathe);
  });

  // Embers update
  const posArr = emberGeo.attributes.position.array;
  const lifeArr = emberGeo.attributes.aLife.array;
  for (let i = 0; i < emberCount; i++) {
    lifeArr[i] += 0.002 + Math.random() * 0.003;
    if (lifeArr[i] > 1) {
      initEmber(i);
      continue;
    }
    posArr[i * 3] += emberVelocities[i * 3];
    posArr[i * 3 + 1] += emberVelocities[i * 3 + 1];
    posArr[i * 3 + 2] += emberVelocities[i * 3 + 2];
    // Slight spiral
    const dx = posArr[i * 3];
    const dz = posArr[i * 3 + 2];
    const dist = Math.sqrt(dx * dx + dz * dz) + 0.001;
    posArr[i * 3] += (-dz / dist) * 0.05;
    posArr[i * 3 + 2] += (dx / dist) * 0.05;
  }
  emberGeo.attributes.position.needsUpdate = true;
  emberGeo.attributes.aLife.needsUpdate = true;

  // Pulse rings
  pulseRings.forEach((r, i) => {
    const scale = 1 + Math.sin(t * 0.8 + i * 0.5) * 0.1;
    r.mesh.scale.set(scale, scale, 1);
    r.mesh.material.opacity = 0.02 + Math.sin(t * 1.2 + i) * 0.015;
  });

  // Floating glyphs
  glyphGroup.children.forEach(sprite => {
    const d = sprite.userData;
    d.angle += d.speed * 0.01;
    sprite.position.x = Math.cos(d.angle) * d.r;
    sprite.position.z = Math.sin(d.angle) * d.r;
    sprite.position.y = d.baseY + Math.sin(t * 0.5 + d.angle) * 5;
    sprite.material.opacity = 0.04 + Math.sin(t + d.angle * 2) * 0.02;
  });

  composer.render();
}

animate();

// ── Resize ──
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
  composer.setSize(window.innerWidth, window.innerHeight);
});

// ── Remove curtains after animation ──
setTimeout(() => {
  document.querySelector('.curtain-left')?.remove();
  document.querySelector('.curtain-right')?.remove();
  document.querySelector('.curtain-line')?.remove();
}, 3000);
</script>

</body>
</html>
